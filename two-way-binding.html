<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ES6 Brown Bag - Spread Operator</title>
    <style>
        input { width: 80%; padding: 2px }
        .bigtext { font-size: 2em; }
        .row { margin-top: 10px; margin-bottom: 5px }
    </style>
</head>
<body>


<div class="row">
    <span class="bigtext">Text 1:</span> <input data-model="text" class="bigtext" type="text" placeholder="type here"/>
</div>
<div>
    <span class="bigtext">Text 2:</span> <input data-model="text" class="bigtext" type="text" placeholder="type here"/>
</div>
<div>
    <span class="bigtext">Result:</span> <span class="bigtext" data-model="text"></span>
</div>
<pre class="prettyprint"></pre>
    <script type="text/javascript" id="script">


    let store = {
      listeners: [],
      data: new Proxy({}, {
        set: (target, propertyKey, value)=>  {
            let oldVal = Reflect.get(target, propertyKey);
            store.listeners.filter( o => o.key === propertyKey).forEach( o => o.obj.receive(propertyKey, value, oldVal))
            Reflect.set(target, propertyKey, value)
        }
      }),
      subscribe(key, obj) {
        obj.send = (value) => {
          this.data[key] = value;
        }
        if(this.data[key]) {
          obj.receive(key, this.data[key])
        }
        this.listeners.push({ key, obj })
      },
      unsubscribe(key, obj) {
        delete obj.send;
        this.listeners = this.listeners.filter(o => !(o.key === key && o.obj === obj))
      }
    }

    let listeners = document.querySelectorAll('[data-model]').forEach(e => {
      e.receive = function(key, newVal) {
        if(e instanceof HTMLInputElement) {
          this.value = newVal;
        }
        else {
          this.innerText = newVal
        }
      }

      if(e instanceof HTMLInputElement) {
        e.addEventListener('input', () => e.send(e.value))
      }
      store.subscribe(e.getAttribute('data-model'), e);
    });


    </script>
<script>
  document.getElementsByTagName('pre')[0].innerHTML =
    document.getElementsByTagName('title')[0].innerText
    + ' '
    + document.getElementById('script').innerText
</script>

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script></body>
<a href="./index.html">Back</a></html>