<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ES6 Brown Bag - Generators</title>
</head>
<body>

    <pre class="prettyprint"></pre>
    <script type="text/javascript" id="script">

      // simple generator
      function *numbersGenerator() {
        let counter = 0;
        while(true) {
          yield counter++;
        }
      }

//      let numbers = numbersGenerator();
//      console.log(numbers.next()) // returns { value: <any>, done: boolean }
//      console.log(numbers.next())
//      console.log(numbers.next())

      // passing params on generator
      function *paramExample() {
        let a = yield 1;
        console.log('a', a)
        let b = yield 2 + a;
        console.log('b', b)
        let c = yield 3 + b;
        console.log('c', c)
      }

//      let params = paramExample()
//      console.log(params.next())     // returns 1 from 'yield 1', first param is ignored
//      console.log(params.next(100))  // 'a = yield 1' = 100, returns 2 + a
//      console.log(params.next(1000)) // 'b = yield 2' = 1000, returns 3 + b
//      console.log(params.next(0))    // 'c = yield 3' = 0, no more waiting yield, done = true

      // async operations using generators
      let asyncOp1 = () => {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            resolve('asyncOp1 result')
          }, 1500)
        })
      };
      let asyncOp2 = (result) => {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            resolve('asyncOp2: ' + result)
          }, 1500)
        })
      };

      function async(gen) {
        let next = (promise) => {
          if (promise === undefined) return;
          promise.then(data => {
            next(it.next(data).value);
          })
          .catch(err => {
            it.throw(new Error(err));
          })
        }

        let it = gen();
        next(it.next().value)
      }

      async(function *generator() {
        try {
          let a = yield asyncOp1();
          console.log(a)
          let b = yield asyncOp2(a);
          console.log(b)
        } catch (e) {
          console.error('ERROR!!!', e.message)
        }
      })



    </script>
<script>
  document.getElementsByTagName('pre')[0].innerHTML =
    document.getElementsByTagName('title')[0].innerText
    + ' '
    + document.getElementById('script').innerText
</script>

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script></body>
</html>